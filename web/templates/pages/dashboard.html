{{define "content"}}
<div class="page">
    <div class="page-header">
        <h1 class="page-title">Dashboard</h1>
        <div class="quick-actions">
            <a href="/keys" class="btn btn-primary">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M10 1h4v4M10 6l5-5M12 9v5a1 1 0 01-1 1H2a1 1 0 01-1-1V4a1 1 0 011-1h5"/>
                </svg>
                Create API Key
            </a>
            <a href="/users/new" class="btn btn-secondary">Add User</a>
        </div>
    </div>

    {{if not .ChecklistComplete}}
    <!-- Getting Started Checklist -->
    <div class="card mb-4 checklist-card" style="border: 2px solid #10b981;">
        <div class="card-header" style="background: #ecfdf5;">
            <span class="card-title" style="color: #059669;">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: middle; margin-right: 6px;"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                Getting Started
            </span>
            <span class="badge" style="background: #d1fae5; color: #059669;">{{.ChecklistProgress}} of {{.ChecklistTotal}} complete</span>
        </div>
        <div class="card-body">
            <div class="checklist">
                {{range .Checklist}}
                <div class="checklist-item {{if .Done}}checklist-done{{end}}">
                    <div class="checklist-check">
                        {{if .Done}}
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"/>
                        </svg>
                        {{else}}
                        <span class="checklist-number"></span>
                        {{end}}
                    </div>
                    <div class="checklist-content">
                        <div class="checklist-title">{{.Title}}</div>
                        <div class="checklist-desc">{{.Description}}</div>
                        {{if and .Done .Summary}}
                        <div class="checklist-summary text-muted text-sm">{{.Summary}}</div>
                        {{end}}
                    </div>
                    {{if .Done}}
                    <a href="{{.Link}}" class="link text-sm">View</a>
                    {{else}}
                    <a href="{{.Link}}" class="btn btn-sm btn-primary">{{.LinkText}}</a>
                    {{end}}
                </div>
                {{end}}
            </div>
        </div>
    </div>
    {{end}}

    {{if .PortalEnabled}}
    <!-- Customer Portal Info -->
    <div class="card mb-4" style="border: 2px solid #8b5cf6; background: #f5f3ff;">
        <div class="card-header" style="background: #ede9fe;">
            <span class="card-title" style="color: #7c3aed;">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: middle; margin-right: 6px;"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                Customer Portal
            </span>
            <span class="badge" style="background: #ddd6fe; color: #7c3aed;">Enabled</span>
        </div>
        <div class="card-body">
            <p class="text-sm mb-2">Share this link with your customers so they can self-register and manage their API keys:</p>
            <div class="code-block" style="background: #1e293b; color: #e2e8f0; padding: 12px 16px; border-radius: 6px; font-family: monospace; font-size: 13px; overflow-x: auto; position: relative;">
                <code id="portal-url">{{.PortalURL}}</code>
                <button onclick="copyPortalURL()" class="btn btn-sm" style="position: absolute; right: 8px; top: 8px; background: #334155; color: white; border: none; padding: 4px 8px; font-size: 11px;">Copy</button>
            </div>
            <p class="text-muted text-sm mt-2">Customers can sign up, create API keys, and view their usage. <a href="/settings" class="link">Configure portal settings</a></p>
        </div>
    </div>
    <script>
    function copyPortalURL() {
        const url = document.getElementById('portal-url').textContent;
        navigator.clipboard.writeText(url).then(() => {
            const btn = event.target;
            btn.textContent = 'Copied!';
            setTimeout(() => btn.textContent = 'Copy', 2000);
        });
    }
    </script>
    {{end}}

    {{if and .TestCommand (not .HasAPIActivity)}}
    <!-- Try Your API Section -->
    <div class="card mb-4" style="border: 2px solid #3b82f6; background: #eff6ff;">
        <div class="card-header">
            <span class="card-title" style="color: #1d4ed8;">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: middle; margin-right: 6px;"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
                Try Your API
            </span>
            <span class="text-muted text-sm">Run this command to test your gateway</span>
        </div>
        <div class="card-body">
            <p class="text-sm mb-2">Copy and run this command in your terminal:</p>
            <div class="code-block" style="background: #1e293b; color: #e2e8f0; padding: 12px 16px; border-radius: 6px; font-family: monospace; font-size: 13px; overflow-x: auto; position: relative;">
                <code id="test-command">{{.TestCommand}}</code>
                <button onclick="copyTestCommand()" class="btn btn-sm" style="position: absolute; right: 8px; top: 8px; background: #334155; color: white; border: none; padding: 4px 8px; font-size: 11px;">Copy</button>
            </div>
            <p class="text-muted text-sm mt-2">After running, your request will appear in the activity log below.</p>
        </div>
    </div>
    <script>
    function copyTestCommand() {
        const cmd = document.getElementById('test-command').textContent;
        navigator.clipboard.writeText(cmd).then(() => {
            const btn = event.target;
            btn.textContent = 'Copied!';
            setTimeout(() => btn.textContent = 'Copy', 2000);
        });
    }
    </script>
    {{end}}

    <!-- Stats -->
    <div class="grid grid-4 mb-4" hx-get="/partials/stats" hx-trigger="load, every 30s" hx-swap="innerHTML">
        {{template "stats" .Stats}}
    </div>

    <!-- Recent Data -->
    <div class="grid grid-2">
        <div class="card">
            <div class="card-header">
                <span class="card-title">Recent Users</span>
                <a href="/users" class="link text-sm">View all</a>
            </div>
            <div class="card-body flush" hx-get="/partials/users?limit=5" hx-trigger="load" hx-swap="innerHTML">
                <div class="table-empty">Loading...</div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <span class="card-title">Recent API Keys</span>
                <a href="/keys" class="link text-sm">View all</a>
            </div>
            <div class="card-body flush" hx-get="/partials/keys?limit=5" hx-trigger="load" hx-swap="innerHTML">
                <div class="table-empty">Loading...</div>
            </div>
        </div>
    </div>

    <!-- Activity -->
    <div class="card mt-6">
        <div class="card-header">
            <span class="card-title">Recent Activity</span>
        </div>
        <div class="card-body flush" hx-get="/partials/activity?limit=10" hx-trigger="load, every 30s" hx-swap="innerHTML">
            <div class="table-empty">Loading...</div>
        </div>
    </div>
</div>
{{end}}

{{define "stats"}}
<div class="card">
    <div class="stat">
        <div class="stat-label">
            Total Users
            <span class="info-tooltip" data-tip="The total number of registered users who can access your API. Each user can have multiple API keys.">i</span>
        </div>
        <div class="stat-value">{{.TotalUsers}}</div>
    </div>
</div>
<div class="card">
    <div class="stat">
        <div class="stat-label">
            Active API Keys
            <span class="info-tooltip" data-tip="API keys that are currently active and can make requests. Revoked keys are not counted here.">i</span>
        </div>
        <div class="stat-value">{{.ActiveKeys}}</div>
    </div>
</div>
<div class="card">
    <div class="stat">
        <div class="stat-label">
            Requests Today
            <span class="info-tooltip" data-tip="Total API requests processed through your gateway since midnight (local time). Updates every 30 seconds.">i</span>
        </div>
        <div class="stat-value">{{.RequestsToday}}</div>
    </div>
</div>
<div class="card">
    <div class="stat">
        <div class="stat-label">
            Monthly Revenue
            <span class="info-tooltip" data-tip="Monthly Recurring Revenue (MRR) based on active users and their plan prices.">i</span>
        </div>
        <div class="stat-value">${{printf "%.2f" .MRR}}</div>
    </div>
</div>
{{end}}

{{define "panel-docs"}}
<div class="panel-section">
    <h3>Dashboard Overview</h3>
    <p>Your central hub for monitoring API gateway activity and managing your setup.</p>
</div>

<div class="panel-section">
    <h4>Quick Actions</h4>
    <ul class="panel-list">
        <li><a href="/routes" class="panel-link">Configure Routes</a> - Set up API routing rules</li>
        <li><a href="/keys" class="panel-link">Manage API Keys</a> - Create and revoke keys</li>
        <li><a href="/usage" class="panel-link">View Usage</a> - Monitor API consumption</li>
    </ul>
</div>

<div class="panel-section">
    <h4>Understanding Stats</h4>
    <ul class="panel-list">
        <li><strong>Total Users</strong> - Registered API consumers</li>
        <li><strong>Active Keys</strong> - Non-revoked API keys</li>
        <li><strong>Requests Today</strong> - API calls in the last 24h</li>
    </ul>
</div>

<div class="panel-section">
    <h4>Need Help?</h4>
    <p>Press <kbd>?</kbd> anytime to toggle this help panel, or <kbd>Esc</kbd> to close it.</p>
</div>
{{end}}

{{define "panel-reference"}}
<div class="panel-section">
    <h3>API Reference</h3>
    <p>Make authenticated requests to your API gateway.</p>
</div>

<div class="panel-section">
    <h4>Authentication</h4>
    <p>Include your API key in the request header:</p>
    <pre class="code-block">X-API-Key: your_api_key_here</pre>
</div>

<div class="panel-section">
    <h4>Example Request</h4>
    <pre class="code-block">curl -H "X-API-Key: key_..." \
  http://localhost:8080/your-endpoint</pre>
</div>

<div class="panel-section">
    <h4>Response Codes</h4>
    <ul class="panel-list">
        <li><code>200</code> - Success</li>
        <li><code>401</code> - Invalid or missing API key</li>
        <li><code>429</code> - Rate limit exceeded</li>
        <li><code>502</code> - Upstream error</li>
    </ul>
</div>
{{end}}
