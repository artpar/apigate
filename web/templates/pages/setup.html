{{define "content"}}
<div class="setup-container">
    <div class="card setup-card">
        <div class="setup-header">
            <h1 class="setup-title">Welcome to APIGate</h1>
            <p class="setup-subtitle">Let's get you set up in 2 minutes.</p>
        </div>

        <!-- Progress Steps -->
        <div class="steps">
            {{range $i, $step := .Steps}}
            <div class="step-circle {{if eq $i $.CurrentStep}}active{{else if lt $i $.CurrentStep}}done{{end}}">
                {{if lt $i $.CurrentStep}}&#10003;{{else}}{{add $i 1}}{{end}}
            </div>
            {{if lt $i (len $.Steps | add -1)}}<div class="step-line {{if lt $i $.CurrentStep}}done{{end}}"></div>{{end}}
            {{end}}
        </div>

        <div class="setup-body">
            <h2 class="setup-step-title">Step {{add .CurrentStep 1}} of {{len .Steps}}: {{index .Steps .CurrentStep}}</h2>

            {{if eq .CurrentStep 0}}
            <p class="setup-step-desc">Enter the URL of the API you want to share with customers</p>
            <form action="/setup/step/0" method="POST" class="form">
                <div class="form-group">
                    <label for="upstream_url" class="form-label">
                        Your API URL
                        <span class="info-tooltip" data-tip="This is the base URL of your existing API server. APIGate will forward all requests to this address. Example: https://api.mycompany.com">?</span>
                    </label>
                    <input type="url" id="upstream_url" name="upstream_url" required class="form-input" placeholder="https://api.example.com" value="{{.UpstreamURL}}">
                    <p class="form-hint">This is where your actual API lives. APIGate will forward requests here.</p>
                </div>
                <div class="setup-help-tip">
                    <strong>What does APIGate do?</strong>
                    <p>APIGate sits between your customers and your API. It handles authentication, rate limiting, and usage tracking - so you don't have to.</p>
                </div>
                {{if .Error}}<div class="alert alert-error">{{.Error}}</div>{{end}}
                <button type="submit" class="btn btn-primary" style="width: 100%;">Test Connection & Continue</button>
            </form>

            {{else if eq .CurrentStep 1}}
            <p class="setup-step-desc">Create your administrator account to manage APIGate</p>
            <form action="/setup/step/1" method="POST" class="form">
                <div class="form-group">
                    <label for="admin_name" class="form-label">
                        Your Name
                        <span class="info-tooltip" data-tip="Your name as it will appear in the admin dashboard.">?</span>
                    </label>
                    <input type="text" id="admin_name" name="admin_name" required class="form-input" placeholder="John Smith" value="{{.AdminName}}">
                </div>
                <div class="form-group">
                    <label for="admin_email" class="form-label">
                        Your Email
                        <span class="info-tooltip" data-tip="You'll use this email to log into the admin dashboard. It won't be shared with your API users.">?</span>
                    </label>
                    <input type="email" id="admin_email" name="admin_email" required class="form-input" placeholder="you@company.com" value="{{.AdminEmail}}">
                </div>
                <div class="form-group">
                    <label for="admin_password" class="form-label">Choose a Password</label>
                    <input type="password" id="admin_password" name="admin_password" required class="form-input" minlength="8">
                    <p class="form-hint">At least 8 characters. Use a mix of letters, numbers, and symbols for best security.</p>
                </div>
                <div class="form-group">
                    <label for="admin_password_confirm" class="form-label">Confirm Password</label>
                    <input type="password" id="admin_password_confirm" name="admin_password_confirm" required class="form-input">
                </div>
                {{if .Error}}<div class="alert alert-error">{{.Error}}</div>{{end}}
                <div class="setup-actions">
                    <a href="/setup/step/0" class="btn btn-secondary">Back</a>
                    <button type="submit" class="btn btn-primary">Continue</button>
                </div>
            </form>

            {{else if eq .CurrentStep 2}}
            <p class="setup-step-desc">Define your pricing and usage limits. You can add more plans later.</p>
            <form action="/setup/step/2" method="POST" class="form">
                <div class="form-group">
                    <label for="plan_name" class="form-label">
                        Plan Name
                        <span class="info-tooltip" data-tip="This is what your customers will see. Common examples: Free, Basic, Starter, Pro, Enterprise">?</span>
                    </label>
                    <input type="text" id="plan_name" name="plan_name" required class="form-input" placeholder="Starter" value="{{.PlanName}}">
                    <p class="form-hint">What should customers see? (e.g., Free, Starter, Pro)</p>
                </div>

                <h4 style="margin: 24px 0 12px 0; color: #374151;">Pricing</h4>
                <div class="form-group">
                    <label for="price_monthly" class="form-label">
                        Monthly Price ($)
                        <span class="info-tooltip" data-tip="How much to charge per month. Set to 0 for a free plan.">?</span>
                    </label>
                    <input type="number" id="price_monthly" name="price_monthly" class="form-input" value="{{if .PriceMonthly}}{{.PriceMonthly}}{{else}}0{{end}}" min="0" step="0.01">
                    <p class="form-hint">Set to $0 for a free tier, or enter your monthly subscription price.</p>
                </div>
                <div class="form-group">
                    <label for="overage_price" class="form-label">
                        Overage Price ($ per 1000 requests)
                        <span class="info-tooltip" data-tip="Optional: Charge per 1000 requests over the monthly limit. Leave at 0 to block requests when quota is exceeded.">?</span>
                    </label>
                    <input type="number" id="overage_price" name="overage_price" class="form-input" value="{{if .OveragePrice}}{{.OveragePrice}}{{else}}0{{end}}" min="0" step="0.01">
                    <p class="form-hint">Leave at $0 to block requests when quota is exceeded.</p>
                </div>

                <h4 style="margin: 24px 0 12px 0; color: #374151;">Usage Limits</h4>
                <div class="form-group">
                    <label for="rate_limit" class="form-label">
                        Requests per Minute
                        <span class="info-tooltip" data-tip="How many requests can one user make per minute? This prevents anyone from overwhelming your API. 60/min is reasonable for most APIs.">?</span>
                    </label>
                    <input type="number" id="rate_limit" name="rate_limit" required class="form-input" value="{{if .RateLimit}}{{.RateLimit}}{{else}}60{{end}}" min="1">
                    <p class="form-hint">Prevents API abuse. 60/min is a good starting point.</p>
                </div>
                <div class="form-group">
                    <label for="monthly_quota" class="form-label">
                        Monthly Request Limit
                        <span class="info-tooltip" data-tip="Total requests a user can make in a calendar month. When they hit this limit, requests will be blocked (or charged overage) until next month.">?</span>
                    </label>
                    <input type="number" id="monthly_quota" name="monthly_quota" required class="form-input" value="{{if .MonthlyQuota}}{{.MonthlyQuota}}{{else}}1000{{end}}" min="1">
                    <p class="form-hint">Total requests allowed per month. 1,000 is typical for free tiers.</p>
                </div>
                <div class="setup-help-tip">
                    <strong>Tip: Start free, upgrade later</strong>
                    <p>Many successful APIs start with a free tier to attract users. You can add paid plans like "Pro" with higher limits from the dashboard anytime.</p>
                </div>
                {{if .Error}}<div class="alert alert-error">{{.Error}}</div>{{end}}
                <div class="setup-actions">
                    <a href="/setup/step/1" class="btn btn-secondary">Back</a>
                    <button type="submit" class="btn btn-primary">Create Plan & Continue</button>
                </div>
            </form>

            {{else if eq .CurrentStep 3}}
            <div class="setup-success">
                <div class="setup-success-icon">&#10003;</div>
                <h3>You're All Set!</h3>
                <p>APIGate is ready to proxy requests to your API.</p>

                <div class="setup-summary">
                    <h4>What's been configured:</h4>
                    <ul class="setup-checklist">
                        <li><span class="check">&#10003;</span> Your API is connected</li>
                        <li><span class="check">&#10003;</span> Admin account created</li>
                        <li><span class="check">&#10003;</span> First pricing plan ready</li>
                    </ul>
                </div>

                <div class="setup-next-steps">
                    <h4>What to do next:</h4>
                    <div class="next-step-card">
                        <div class="next-step-number">1</div>
                        <div class="next-step-content">
                            <strong>Create an API Key</strong>
                            <p>Generate a key to authenticate your API requests</p>
                        </div>
                    </div>
                    <div class="next-step-card">
                        <div class="next-step-number">2</div>
                        <div class="next-step-content">
                            <strong>Make a Test Request</strong>
                            <p>Try calling your API through APIGate</p>
                        </div>
                    </div>
                </div>

                <div class="setup-actions-final">
                    <a href="/keys" class="btn btn-primary btn-lg">Create Your First API Key</a>
                    <a href="/dashboard" class="btn btn-secondary">Go to Dashboard</a>
                </div>
            </div>
            {{end}}
        </div>
    </div>
</div>
{{end}}
