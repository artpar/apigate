{{define "content"}}
<div class="page">
    <div class="page-header">
        <h1 class="page-title">Usage Statistics</h1>
    </div>

    <!-- Filters -->
    <div class="card mb-4">
        <div class="card-body">
            <form action="/usage" method="GET" class="flex gap-4" style="flex-wrap: wrap; align-items: flex-end;">
                <div class="form-group" style="margin: 0;">
                    <label for="user_id" class="form-label">User</label>
                    <select id="user_id" name="user_id" class="form-input">
                        <option value="">All Users</option>
                        {{range .Users}}
                        <option value="{{.ID}}" {{if eq .ID $.SelectedUser}}selected{{end}}>{{.Email}}</option>
                        {{end}}
                    </select>
                </div>
                <div class="form-group" style="margin: 0;">
                    <label for="period" class="form-label">Period</label>
                    <select id="period" name="period" class="form-input">
                        <option value="day" {{if eq .Period "day"}}selected{{end}}>Today</option>
                        <option value="week" {{if eq .Period "week"}}selected{{end}}>This Week</option>
                        <option value="month" {{if eq .Period "month"}}selected{{end}}>This Month</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Apply Filters</button>
            </form>
        </div>
    </div>

    <!-- Summary Cards -->
    <div class="grid mb-4" style="grid-template-columns: repeat(4, 1fr);">
        <div class="card">
            <div class="stat">
                <div class="stat-label">Total Requests</div>
                <div class="stat-value">{{.Summary.TotalRequests}}</div>
            </div>
        </div>
        <div class="card">
            <div class="stat">
                <div class="stat-label">Successful</div>
                <div class="stat-value" style="color: #16a34a;">{{.Summary.Successful}}</div>
            </div>
        </div>
        <div class="card">
            <div class="stat">
                <div class="stat-label">Rate Limited</div>
                <div class="stat-value" style="color: #ca8a04;">{{.Summary.RateLimited}}</div>
            </div>
        </div>
        <div class="card">
            <div class="stat">
                <div class="stat-label">Errors</div>
                <div class="stat-value" style="color: #dc2626;">{{.Summary.Errors}}</div>
            </div>
        </div>
    </div>

    <!-- Usage Table -->
    <div class="card">
        <div class="card-body flush">
            <table class="table">
                <thead>
                    <tr>
                        <th>User</th>
                        <th>Key</th>
                        <th>Requests</th>
                        <th>Last Used</th>
                    </tr>
                </thead>
                <tbody>
                    {{range .UsageData}}
                    <tr>
                        <td class="cell-primary">{{.UserEmail}}</td>
                        <td class="cell-mono text-muted">{{maskKey .KeyID}}</td>
                        <td>{{.RequestCount}}</td>
                        <td class="text-muted">{{timeAgo .LastUsed}}</td>
                    </tr>
                    {{else}}
                    <tr><td colspan="4" class="table-empty">
                        <div class="empty-state-inline">
                            <strong>No usage data yet</strong>
                            <p>Usage data appears here when users make API requests. Try changing the time period.</p>
                        </div>
                    </td></tr>
                    {{end}}
                </tbody>
            </table>
        </div>
    </div>
</div>
{{end}}

{{define "panel-docs"}}
<div class="panel-section">
    <h3>Usage Statistics</h3>
    <p>Monitor API consumption across all users and API keys. Track requests, errors, and rate limiting.</p>
</div>

<div class="panel-section">
    <h4>Statistics Explained</h4>
    <ul class="panel-list">
        <li><strong>Total Requests</strong> - All API calls in the selected period</li>
        <li><strong>Successful</strong> - Requests that returned 2xx status</li>
        <li><strong>Rate Limited</strong> - Requests blocked due to rate limits (429)</li>
        <li><strong>Errors</strong> - Requests with 4xx/5xx errors</li>
    </ul>
</div>

<div class="panel-section">
    <h4>Filtering</h4>
    <ul class="panel-list">
        <li><strong>User</strong> - Filter by specific user or view all</li>
        <li><strong>Period</strong> - Today, this week, or this month</li>
    </ul>
</div>

<div class="panel-section">
    <h4>Usage Tracking</h4>
    <p>Usage is tracked per API key and aggregated by user. This data is used to enforce monthly quotas and for billing purposes.</p>
</div>
{{end}}
