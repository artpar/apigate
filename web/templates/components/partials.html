{{define "partial_users"}}
<table class="table">
    <thead>
        <tr>
            <th>Email</th>
            <th>Name</th>
            <th>Plan</th>
            <th>Status</th>
            <th>Created</th>
            <th class="cell-actions">Actions</th>
        </tr>
    </thead>
    <tbody>
        {{range .Users}}
        <tr>
            <td class="cell-primary">{{.Email}}</td>
            <td class="text-muted">{{if .Name}}{{.Name}}{{else}}-{{end}}</td>
            <td class="text-muted">{{index $.PlanNames .PlanID}}</td>
            <td>
                <span class="badge {{if eq .Status "active"}}badge-success{{else if eq .Status "pending"}}badge-warning{{else}}badge-error{{end}}">{{.Status}}</span>
            </td>
            <td class="text-muted">{{formatDate .CreatedAt}}</td>
            <td class="cell-actions">
                <a href="/users/{{.ID}}" class="link">Edit</a>
                <button hx-delete="/users/{{.ID}}" hx-confirm="Are you sure you want to delete this user? This will also revoke all their API keys. This action cannot be undone." hx-target="#users-table" class="link link-danger" style="margin-left: 12px;">Delete</button>
            </td>
        </tr>
        {{else}}
        <tr><td colspan="6" class="table-empty">
            <div class="empty-state-inline">
                <strong>No users yet</strong>
                <p>Users can access your API with API keys. <a href="/users/new" class="link">Add your first user</a> or enable the <a href="/settings" class="link">customer portal</a> for self-registration.</p>
            </div>
        </td></tr>
        {{end}}
    </tbody>
</table>
{{end}}

{{define "partial_keys"}}
<table class="table">
    <thead>
        <tr>
            <th>Key</th>
            <th>Name</th>
            <th>User</th>
            <th>Status</th>
            <th>Created</th>
            <th>Last Used</th>
            <th class="cell-actions">Actions</th>
        </tr>
    </thead>
    <tbody>
        {{range .Keys}}
        <tr>
            <td class="cell-mono">{{.Prefix}}****</td>
            <td>{{if .Name}}{{.Name}}{{else}}<span class="text-muted">Unnamed</span>{{end}}</td>
            <td class="text-muted">{{index $.UserEmails .UserID}}</td>
            <td>
                {{if .RevokedAt}}
                <span class="badge badge-error">revoked</span>
                {{else}}
                <span class="badge badge-success">active</span>
                {{end}}
            </td>
            <td class="text-muted">{{formatDate .CreatedAt}}</td>
            <td class="text-muted">{{if .LastUsed}}{{timeAgo .LastUsed}}{{else}}Never{{end}}</td>
            <td class="cell-actions">
                {{if not .RevokedAt}}
                <button hx-delete="/keys/{{.ID}}" hx-confirm="Revoke this key?" hx-target="#keys-table" class="link link-danger">Revoke</button>
                {{else}}
                <span class="text-muted">-</span>
                {{end}}
            </td>
        </tr>
        {{else}}
        <tr><td colspan="7" class="table-empty">
            <div class="empty-state-inline">
                <strong>No API keys yet</strong>
                <p>API keys authenticate requests to your gateway. <a href="/keys" class="link">Create your first key</a></p>
            </div>
        </td></tr>
        {{end}}
    </tbody>
</table>
{{end}}

{{define "partial_activity"}}
{{if .Activities}}
<div>
    {{range .Activities}}
    <div class="activity-item">
        <div class="activity-dot {{.Type}}"></div>
        <div>
            <div class="activity-text">{{.Message}}</div>
            <div class="activity-time">{{timeAgo .Timestamp}}</div>
        </div>
    </div>
    {{end}}
</div>
{{else}}
<div class="table-empty">
    <div class="empty-state-inline">
        <strong>No activity yet</strong>
        <p>Activity will appear here once users start making API requests.</p>
    </div>
</div>
{{end}}
{{end}}

{{define "partial_routes"}}
<table class="table">
    <thead>
        <tr>
            <th>Name</th>
            <th>Path Pattern</th>
            <th>Upstream</th>
            <th>Metering</th>
            <th>Protocol</th>
            <th>Status</th>
            <th class="cell-actions">Actions</th>
        </tr>
    </thead>
    <tbody>
        {{range .Routes}}
        <tr>
            <td>
                <div class="cell-primary">{{.Name}}</div>
                <div class="cell-secondary">Priority: {{.Priority}}</div>
            </td>
            <td>
                <div class="cell-primary cell-mono">{{.PathPattern}}</div>
                <div class="cell-secondary">{{.MatchType}}{{if .Methods}} | {{range $i, $m := .Methods}}{{if $i}}, {{end}}{{$m}}{{end}}{{end}}</div>
            </td>
            <td class="text-muted">{{index $.UpstreamMap .UpstreamID}}</td>
            <td class="text-muted">
                {{if .MeteringExpr}}
                    <span class="badge badge-info" title="{{.MeteringExpr}}">{{.MeteringUnit}}</span>
                    <div class="cell-secondary" style="max-width: 120px; overflow: hidden; text-overflow: ellipsis;">{{.MeteringMode}}</div>
                {{else}}
                    <span class="text-muted">1 request</span>
                {{end}}
            </td>
            <td class="text-muted">{{.Protocol}}</td>
            <td>
                <span class="badge {{if .Enabled}}badge-success{{else}}badge-error{{end}}">{{if .Enabled}}enabled{{else}}disabled{{end}}</span>
            </td>
            <td class="cell-actions">
                <a href="/routes/{{.ID}}" class="link">Edit</a>
                <button hx-delete="/routes/{{.ID}}" hx-confirm="Are you sure you want to delete this route? Requests matching this route will no longer be proxied. This action cannot be undone." hx-target="#routes-table" class="link link-danger" style="margin-left: 12px;">Delete</button>
            </td>
        </tr>
        {{else}}
        <tr><td colspan="7" class="table-empty">
            <div class="empty-state-inline">
                <strong>No routes configured</strong>
                <p>Routes define how incoming requests are mapped to your APIs. First <a href="/upstreams/new" class="link">add an upstream</a>, then <a href="/routes/new" class="link">create a route</a>.</p>
            </div>
        </td></tr>
        {{end}}
    </tbody>
</table>
{{end}}

{{define "partial_upstreams"}}
<table class="table">
    <thead>
        <tr>
            <th>Name</th>
            <th>Base URL</th>
            <th>Auth</th>
            <th>Timeout</th>
            <th>Status</th>
            <th class="cell-actions">Actions</th>
        </tr>
    </thead>
    <tbody>
        {{range .Upstreams}}
        <tr>
            <td class="cell-primary">{{.Name}}</td>
            <td class="cell-mono text-muted">{{truncate .BaseURL 50}}</td>
            <td class="text-muted">{{.AuthType}}</td>
            <td class="text-muted">{{.Timeout}}</td>
            <td>
                <span class="badge {{if .Enabled}}badge-success{{else}}badge-error{{end}}">{{if .Enabled}}enabled{{else}}disabled{{end}}</span>
            </td>
            <td class="cell-actions">
                <a href="/upstreams/{{.ID}}" class="link">Edit</a>
                <button hx-delete="/upstreams/{{.ID}}" hx-confirm="Delete this upstream?" hx-target="#upstreams-table" class="link link-danger" style="margin-left: 12px;">Delete</button>
            </td>
        </tr>
        {{else}}
        <tr><td colspan="6" class="table-empty">
            <div class="empty-state-inline">
                <strong>No upstreams configured</strong>
                <p>Upstreams are your backend API servers. <a href="/upstreams/new" class="link">Add an upstream</a></p>
            </div>
        </td></tr>
        {{end}}
    </tbody>
</table>
{{end}}

{{define "partial_plans"}}
<table class="table">
    <thead>
        <tr>
            <th>Name</th>
            <th>Rate Limit</th>
            <th>{{$.Labels.QuotaLabel}}</th>
            <th>Price</th>
            <th>Over Quota</th>
            <th>Users</th>
            <th>Status</th>
            <th class="cell-actions">Actions</th>
        </tr>
    </thead>
    <tbody>
        {{range .Plans}}
        <tr>
            <td class="cell-primary">{{.Name}}</td>
            <td class="text-muted">{{.RateLimit}} {{$.Labels.RateLimitLabel}}</td>
            <td class="text-muted">{{if eq .MonthlyQuota 0}}Unlimited{{else}}{{.MonthlyQuota}}{{end}}</td>
            <td class="text-muted">${{printf "%.2f" .PriceMonthly}}/mo</td>
            <td class="text-muted">{{if gt .OveragePrice 0.0}}<span class="badge badge-info">${{printf "%.4f" .OveragePrice}} {{$.Labels.OverageLabel}}</span>{{else}}<span class="badge badge-warning">Blocked</span>{{end}}</td>
            <td class="text-muted">{{.UserCount}}</td>
            <td>
                {{if .IsDefault}}<span class="badge badge-info" style="margin-right: 4px;">default</span>{{end}}
                <span class="badge {{if .Enabled}}badge-success{{else}}badge-error{{end}}">{{if .Enabled}}enabled{{else}}disabled{{end}}</span>
            </td>
            <td class="cell-actions">
                <a href="/plans/{{.ID}}" class="link">Edit</a>
                <button hx-delete="/plans/{{.ID}}" hx-confirm="Are you sure you want to delete this plan? Users on this plan will need to be moved to another plan. This action cannot be undone." hx-target="#plans-table" class="link link-danger" style="margin-left: 12px;">Delete</button>
            </td>
        </tr>
        {{else}}
        <tr><td colspan="8" class="table-empty">
            <div class="empty-state-inline">
                <strong>No plans configured</strong>
                <p>Plans define rate limits and quotas for your users. <a href="/plans/new" class="link">Create a plan</a></p>
            </div>
        </td></tr>
        {{end}}
    </tbody>
</table>
{{end}}
