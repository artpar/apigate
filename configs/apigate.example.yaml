# APIGate Configuration
# Copy to apigate.yaml and customize
# Environment variables can be used: ${VAR_NAME}

server:
  host: "0.0.0.0"
  port: 8080                  # Proxy port
  read_timeout: 30s
  write_timeout: 60s

# Your upstream API to proxy
upstream:
  url: "http://localhost:3000"
  timeout: 30s
  max_idle_conns: 100
  idle_conn_timeout: 90s

# Database (SQLite default, Postgres for production)
database:
  driver: sqlite              # sqlite | postgres
  dsn: "./data/apigate.db"
  # For postgres:
  # driver: postgres
  # dsn: "postgres://user:pass@localhost:5432/apigate?sslmode=disable"

# Authentication
# Modes: "local" (built-in) or "remote" (delegate to external service)
auth:
  mode: "local"               # "local" or "remote"
  key_prefix: "ak_"           # Prefix for API keys

  # For remote auth - delegate to your existing auth system:
  # mode: "remote"
  # remote:
  #   url: "https://your-auth-service.com/api"
  #   api_key: "${AUTH_SERVICE_API_KEY}"
  #   timeout: 5s
  #   headers:
  #     X-Service: "apigate"

# Rate limiting
rate_limit:
  enabled: true
  burst_tokens: 10            # Extra tokens for bursts
  window_secs: 60             # Window duration

# Usage tracking
# Modes: "local" (store in database) or "remote" (send to external service)
usage:
  mode: "local"               # "local" or "remote"
  batch_size: 100
  flush_interval: 10s

  # For remote usage - send to your analytics system:
  # mode: "remote"
  # remote:
  #   url: "https://your-analytics.com/api"
  #   api_key: "${ANALYTICS_API_KEY}"

# Billing
# Modes: "none", "stripe", "paddle", "lemonsqueezy", or "remote"
billing:
  mode: "none"                # Disable billing by default

  # For Stripe:
  # mode: "stripe"
  # stripe_key: "${STRIPE_SECRET_KEY}"
  # stripe_webhook_secret: "${STRIPE_WEBHOOK_SECRET}"

  # For Paddle:
  # mode: "paddle"
  # paddle_vendor_id: "12345"
  # paddle_api_key: "${PADDLE_API_KEY}"

  # For LemonSqueezy:
  # mode: "lemonsqueezy"
  # lemon_api_key: "${LEMON_API_KEY}"

  # For remote billing - delegate to your existing billing system:
  # mode: "remote"
  # remote:
  #   url: "https://your-billing.com/api"
  #   api_key: "${BILLING_API_KEY}"

# Plans define access tiers
plans:
  - id: free
    name: "Free"
    requests_per_month: 1000
    rate_limit_per_minute: 10
    price_monthly: 0

  - id: starter
    name: "Starter"
    requests_per_month: 50000
    rate_limit_per_minute: 60
    price_monthly: 2900        # $29.00 in cents
    overage_price: 50          # $0.0050 per extra request

  - id: pro
    name: "Pro"
    requests_per_month: 500000
    rate_limit_per_minute: 300
    price_monthly: 9900        # $99.00
    overage_price: 30          # $0.0030

  - id: enterprise
    name: "Enterprise"
    requests_per_month: -1     # Unlimited
    rate_limit_per_minute: 1000
    price_monthly: 49900

# Endpoint-specific pricing multipliers
endpoints:
  - path: "/v1/expensive-operation"
    method: "POST"
    cost_multiplier: 10        # Counts as 10 requests

  - path: "/v1/cheap-read"
    method: "GET"
    cost_multiplier: 0.1       # Counts as 0.1 requests

# Logging
logging:
  level: info                  # debug | info | warn | error
  format: json                 # json | console
